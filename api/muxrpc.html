<html>
    <head>
    <title>MuxRPC - Documentation - SSBC</title>
    <link rel="stylesheet" href="/normalize.css">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/monokai.css">
    <script src="/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
    <body>
      <div id="leftnav">
    <div class="leftnav-item ">
      <a href="/patchwork" title="Patchwork">Patchwork<br><small>Messaging App</small></a>
    </div>
    <div class="leftnav-subitems">
      <div class="leftnav-item ">
      <a href="/docs/patchwork/install.html" title="Install">Install</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/patchwork/help-faq.html" title="Help / FAQ">Help / FAQ</a>
    </div>
    </div>
    <div class="leftnav-item ">
      <a href="/scuttlebot" title="Scuttlebot">Scuttlebot<br><small>P2P Database</small></a>
    </div>
    <div class="leftnav-subitems">
      <div class="leftnav-item ">
      <a href="/docs/sbot/install.html" title="Install">Install</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/sbot/tutorial.html" title="Tutorial">Tutorial</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/sbot/howto-setup-a-pub.html" title="HOWTO: Setup a Pub">HOWTO: Setup a Pub</a>
    </div>
    </div>
    <div class="leftnav-item ">
      <a href="/secure-scuttlebutt" title="Secure Scuttlebutt">Secure Scuttlebutt<br><small>Database Protocol</small></a>
    </div>
    <div class="leftnav-subitems">
      <div class="leftnav-item ">
      <a href="/docs/ssb/learn.html" title="Learn about the Protocol">Learn about the Protocol</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/ssb/secret-handshake.html" title="Secret Handshake">Secret Handshake</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/ssb/end-to-end-encryption.html" title="End-to-end Encryption">End-to-end Encryption</a>
    </div>
    </div>
    <div class="leftnav-item">API Documentation</div>
    <div class="leftnav-subitems">
      <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot.html" title="scuttlebot">scuttlebot</a>
    </div>
      <div class="leftnav-indent">
        <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot-blobs.html" title="blobs">blobs</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot-block.html" title="block">block</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot-friends.html" title="friends">friends</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot-gossip.html" title="gossip">gossip</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot-invite.html" title="invite">invite</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/scuttlebot-replicate.html" title="replicate">replicate</a>
    </div>
      </div>
      <div class="leftnav-item ">
      <a href="/docs/api/ssb-msgs.html" title="ssb-msgs">ssb-msgs</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/api/ssb-msg-schemas.html" title="ssb-msg-schemas">ssb-msg-schemas</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/api/ssb-ref.html" title="ssb-ref">ssb-ref</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/api/ssb-keys.html" title="ssb-keys">ssb-keys</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/api/ssb-config.html" title="ssb-config">ssb-config</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/api/secret-stack.html" title="secret-stack">secret-stack</a>
    </div>
      <div class="leftnav-item selected">
      <a href="/docs/api/muxrpc.html" title="muxrpc">muxrpc</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/api/pull-stream.html" title="pull-stream">pull-stream</a>
    </div>
    </div>
    <div class="leftnav-item">Articles</div>
    <div class="leftnav-subitems">
      <div class="leftnav-item ">
      <a href="/docs/articles/design-challenge-avoid-centralization-and-singletons.html" title="Design Challenge: Avoiding Centralization and Singletons">Design Challenge: Avoiding Centralization and Singletons</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/articles/design-challenge-sybil-attack.html" title="Design Challenge: Sybil Attacks">Design Challenge: Sybil Attacks</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/articles/desirable-properties-for-a-secure-channel.html" title="Desirable Properties for a Secure Channel">Desirable Properties for a Secure Channel</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/articles/secure-private-channels.html" title="Secure, Private Channels: the Good, the Bad, and the Ugly">Secure, Private Channels: the Good, the Bad, and the Ugly</a>
    </div>
      <div class="leftnav-item ">
      <a href="/docs/articles/using-trust-in-open-networks.html" title="Using Trust in Open Networks">Using Trust in Open Networks</a>
    </div>
    </div>
  </div>
      <div id="content">
        <h1 id="muxrpc">muxrpc</h1>
<p>combined rpc and multiplexing, with pull-streams.</p>
<p><a href="http://travis-ci.org/ssbc/muxrpc"><img src="https://secure.travis-ci.org/ssbc/muxrpc.png" alt="build status"></a></p>
<h2 id="example">example</h2>
<pre><code class="lang-js">
var MRPC = require(&#39;muxrpc&#39;)

//we need a manifest of methods we wish to expose.
var api = {
  //async is a normal async function
  hello: &#39;async&#39;,

  //source is a pull-stream (readable)
  stuff: &#39;source&#39;

  //TODO: sink and duplex pull-streams
}

//pass the api into the constructor, and then pass the object you are wrapping
//(if there is a local api)
var client = MRPC(api, null) () //remoteApi, localApi
var server = MRPC(null, api) ({
  hello: function (name, cb) {
    cb(null, &#39;hello, &#39; + name + &#39;!&#39;)
  },
  stuff: function () {
    return pull.values([1, 2, 3, 4, 5])
  }
}

var a = client.createStream()
var b = server.createStream()

pull(a, b, a) //pipe together

a.hello(&#39;world&#39;, function (err, value) {
  if(err) throw err
  console.log(value)
  // hello, world!
})

pull(a.stuff(), pull.drain(console.log))
// 1
// 2
// 3
// 4
// 5
</code></pre>
<h2 id="permissions">Permissions</h2>
<p>If you are exposing an api over a network connection,
then you probably want some sort of authorization system.
muxrpc provides some help with this, but leaves most of the trouble up to you.</p>
<pre><code class="lang-js">
var api = {
  foo: &#39;async&#39;,
  bar: &#39;async&#39;,
  auth: &#39;async&#39;
}

var rpc = muxrpc(null, api, serializer)({
  foo: function (val, cb) {
    cb(null, {okay: &#39;foo&#39;})
  },
  bar: function (val, cb) {
    cb(null, {okay: &#39;bar&#39;})
  },
  auth: function (pass) {
    //implement an auth function that sets the permissions,
    //using allow or deny lists.

    if(pass === &#39;whatever&#39;)
      this.permissions({deny: [&#39;bar&#39;]}) //allow everything except &quot;bar&quot;
    else if(pass === &#39;s3cr3tz&#39;)
      this.permissions({}) //allow everything!!!
    else return cb(new Error(&#39;ACCESS DENIED&#39;))

    //else we ARE authorized.
    cb(null, &#39;ACCESS GRANTED&#39;)
  }
}).permissions({allow: [&#39;auth&#39;]})

//Get a stream to connect to the remote. As in the above example!
var ss = rpc.createStream()
</code></pre>
<h2 id="license">License</h2>
<p>MIT</p>

      </div>
    </body>
  </html>